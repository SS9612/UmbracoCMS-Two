@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Umbraco.Cms.Core.Models.Blocks.BlockListItem>;
@using ContentModels = Umbraco.Cms.Web.Common.PublishedModels;
@using UmbracoCMS.ViewModels;
@using UmbracoCMS.Controllers;
@using Umbraco.Cms.Core.Models.PublishedContent;
@using Umbraco.Extensions;
@using System.Linq;

@{
    var content = (ContentModels.AboutCallbackSection)Model.Content;
    var settings = Model.Settings as ContentModels.AboutCallbackSettings;

    const string formScope = "callback-request";
    var formModel = ViewData["CallbackFormModel"] as CallbackFormViewModel;
    if (formModel == null || !string.Equals(formModel.FormId, formScope, System.StringComparison.OrdinalIgnoreCase))
    {
        formModel = new CallbackFormViewModel { FormId = formScope };
    }
    else
    {
        formModel.FormId = formScope;
    }

    var serviceOptions = new List<string> { "Business", "Financial Consulting", "Tax Planning" };
    formModel.Options = serviceOptions;

    if (string.IsNullOrWhiteSpace(formModel.SelectedOption) && formModel.Options.Any())
    {
        formModel.SelectedOption = formModel.Options.First();
    }
}

<section class="py-28">
    <div class="max-w-7xl mx-auto px-4 flex gap-10">

        <div class="flex flex-col w-7/12">
            <div class="about-callback-rte">
                @Html.Raw(content.AboutCallbackSectionBody)
            </div>
        </div>

        <div class="flex flex-col w-5/12 shadow-md -mt-[11rem] z-[99]">
            <div class="bg-primary">
                <p class="text-accent py-[1.5rem] px-[2rem] text-[1.875rem] font-bold">
                    @content.AboutCallBackFormTitle
                </p>
            </div>
            <p class="text-sm py-[1.5rem] px-[2rem] italic">
                @content.AboutCallBackFormDescription
            </p>

            @{
                var formError = TempData[$"FormError_{formModel.FormId}"] as string;
                var formSuccess = TempData[$"FormSuccess_{formModel.FormId}"] as string;
            }

            @if (!string.IsNullOrWhiteSpace(formError))
            {
                <div class="mx-[2rem] mb-4 rounded-[18px] border border-red-200 bg-red-50 px-6 py-3 text-sm text-red-700 shadow-sm">
                    <strong class="text-red-800">Error:</strong>
                    <span class="block">@formError</span>
                </div>
            }

            @if (!string.IsNullOrWhiteSpace(formSuccess))
            {
                <div class="mx-[2rem] mb-4 rounded-[18px] border border-green-200 bg-green-50 px-6 py-3 text-sm text-green-700 shadow-sm">
                    <strong class="text-green-800">@formSuccess</strong>
                </div>
            }

            <partial name="Partials/Forms/_CallbackForm" model="formModel" view-data="@(new ViewDataDictionary(ViewData) { { "FormId", "callbackForm" } })" />
        </div>

    </div>
</section>